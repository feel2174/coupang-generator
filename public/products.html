<!doctype html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ì¿ íŒ¡ ìƒí’ˆ ë¦¬ìŠ¤íŠ¸</title>
    <style>
      body {
        font-family: 'Noto Sans KR', sans-serif;
        background: #f5f7fa;
        margin: 0;
        padding: 0;
        min-height: 100vh;
      }
      .container {
        max-width: 1000px;
        margin: 20px auto;
        background: #fff;
        border-radius: 12px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.07);
        padding: 20px;
        box-sizing: border-box;
      }
      h1 {
        color: #e60023;
        text-align: center;
        margin-bottom: 30px;
        font-size: 2rem;
        word-break: keep-all;
      }
      .search-bar {
        display: flex;
        justify-content: center;
        margin-bottom: 30px;
        gap: 10px;
        flex-wrap: wrap;
      }
      .search-bar input[type="text"] {
        width: 300px;
        padding: 12px;
        border: 1px solid #ddd;
        border-radius: 4px;
        font-size: 16px;
        box-sizing: border-box;
      }
      .search-bar button {
        background: #296dff;
        color: #fff;
        border: none;
        border-radius: 4px;
        padding: 12px 24px;
        font-size: 16px;
        cursor: pointer;
        transition: background 0.2s;
        white-space: nowrap;
      }
      .search-bar button:hover {
        background: #1d4fcc;
      }
      .products-list {
        display: flex;
        flex-direction: column;
        gap: 20px;
        align-items: stretch;
      }
      .product-card {
        width: 100%;
        margin: 0;
        background: #fff;
        border-radius: 10px;
        box-shadow: 0 1px 4px rgba(0,0,0,0.08);
        display: flex;
        flex-direction: column;
        align-items: center;
        padding: 20px;
        gap: 18px;
        box-sizing: border-box;
      }
      .product-image {
        width: 100%;
        max-width: 300px;
        height: auto;
        object-fit: contain;
        border-radius: 8px;
        background: #f8f8f8;
      }
      .product-info {
        width: 100%;
        display: flex;
        flex-direction: column;
        justify-content: center;
      }
      .product-title {
        font-size: 1.1rem;
        font-weight: bold;
        color: #e60023;
        margin-bottom: 8px;
        word-break: keep-all;
      }
      .product-desc {
        font-size: 0.97rem;
        color: #222;
        margin-bottom: 8px;
        min-height: 36px;
        word-break: keep-all;
      }
      .product-meta {
        font-size: 0.93rem;
        color: #444;
        margin-bottom: 8px;
        word-break: keep-all;
      }
      .product-checks {
        margin-bottom: 8px;
      }
      .product-checks span {
        color: #13b02c;
        margin-right: 10px;
        font-size: 1.1em;
      }
      .product-btn {
        background: #296dff;
        color: #fff;
        border: none;
        border-radius: 6px;
        padding: 12px 0;
        font-size: 1.1rem;
        font-weight: bold;
        cursor: pointer;
        width: 100%;
        margin-top: 8px;
        transition: background 0.2s;
        box-sizing: border-box;
      }
      .product-btn:hover {
        background: #1d4fcc;
      }
      .error {
        color: #e60023;
        text-align: center;
        margin-bottom: 20px;
        word-break: keep-all;
      }
      .button-group {
        display: flex;
        gap: 10px;
        margin-bottom: 18px;
        flex-wrap: wrap;
      }
      .button-group button {
        flex: 1;
        min-width: 200px;
      }
      @media (max-width: 768px) {
        .container {
          margin: 10px;
          padding: 15px;
        }
        .search-bar {
          flex-direction: column;
          align-items: stretch;
        }
        .search-bar input[type="text"] {
          width: 100%;
        }
        .search-bar button {
          width: 100%;
        }
        .button-group {
          flex-direction: column;
        }
        .button-group button {
          width: 100%;
        }
        #mainTitle {
          font-size: 1.5em !important;
        }
      }
      @media (max-width: 480px) {
        .container {
          margin: 5px;
          padding: 10px;
        }
        h1 {
          font-size: 1.5rem;
        }
        .product-card {
          padding: 15px;
        }
        .product-title {
          font-size: 1rem;
        }
        .product-desc {
          font-size: 0.9rem;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div style="display:flex;align-items:center;gap:12px;margin-bottom:18px;">
        <div id="mainTitle" style="font-size:2em;font-weight:900;color:#222;"></div>
        <button id="copyTitleBtn" class="product-btn" style="background:#e60023;flex:none;padding:8px 18px;font-size:1em;" onclick="copyTitle()">ì œëª© ë³µì‚¬</button>
      </div>
      <div class="search-bar">
        <input type="text" id="keyword" placeholder="ê²€ìƒ‰í•  ìƒí’ˆ í‚¤ì›Œë“œ ì…ë ¥" />
        <button onclick="searchProducts()">ê²€ìƒ‰</button>
      </div>
      <div class="error" id="error"></div>
      <div class="button-group" style="display:flex; gap:10px; margin-bottom:18px;">
        <button id="copyHtmlBtn" class="product-btn" style="flex:1; background:#28a745;" onclick="copyHtmlContent()">HTML ë³µì‚¬í•˜ê¸°</button>
        <button id="postWpBtn" class="product-btn" style="flex:1; background:#346aff;" onclick="postToWordPress()">ì›Œë“œí”„ë ˆìŠ¤ ì„ì‹œê¸€ë¡œ í¬ìŠ¤íŒ…</button>
      </div>
      <div id="loading" style="display:none; text-align:center; color:#346aff; font-size:1.1em; margin-bottom:12px;">ğŸ”„ ê²€ìƒ‰ ê²°ê³¼ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤...</div>
      <div class="success" id="successMsg" style="display:none; color:#28a745; margin-bottom:10px;"></div>
      <div class="error" id="wpError" style="display:none;"></div>
      <div id="blogContent"></div>
    </div>
    <script>
      let lastHtmlContent = '';
      let lastKeyword = '';
      let lastTitle = '';

      async function searchProducts() {
        const keyword = document.getElementById('keyword').value.trim();
        const errorDiv = document.getElementById('error');
        const blogContent = document.getElementById('blogContent');
        const searchBtn = document.querySelector('.search-bar button');
        const copyBtn = document.getElementById('copyHtmlBtn');
        const postBtn = document.getElementById('postWpBtn');
        const loadingDiv = document.getElementById('loading');
        errorDiv.textContent = '';
        if (blogContent) blogContent.innerHTML = '';
        if (!keyword) {
          errorDiv.textContent = 'í‚¤ì›Œë“œë¥¼ ì…ë ¥í•˜ì„¸ìš”.';
          return;
        }
        try {
          if (searchBtn) searchBtn.disabled = true;
          if (copyBtn) copyBtn.disabled = true;
          if (postBtn) postBtn.disabled = true;
          if (loadingDiv) loadingDiv.style.display = 'block';
          const res = await fetch(`/coupang-products?keyword=${encodeURIComponent(keyword)}&limit=5`);
          const data = await res.json();
          if (!data.success) throw new Error(data.error || 'ìƒí’ˆì„ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.');
          if (!data.products.length) {
            errorDiv.textContent = 'ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.';
            return;
          }
          if (!blogContent) {
            alert('blogContent ì˜ì—­ì´ ì—†ìŠµë‹ˆë‹¤. ê´€ë¦¬ìì—ê²Œ ë¬¸ì˜í•˜ì„¸ìš”.');
            return;
          }
          blogContent.innerHTML = `
            <article style="display:flex; flex-direction:column; gap:20px;">
                ${data.products.map(product => product.gptReview ? product.gptReview : '').join('')}
                <p style="font-size:0.98em;color:#888;margin-top:30px;margin-bottom:0;">ì´ í¬ìŠ¤íŒ…ì€ ì¿ íŒ¡ íŒŒíŠ¸ë„ˆìŠ¤ í™œë™ì˜ ì¼í™˜ìœ¼ë¡œ, ì´ì— ë”°ë¥¸ ì¼ì •ì•¡ì˜ ìˆ˜ìˆ˜ë£Œë¥¼ ì œê³µë°›ìŠµë‹ˆë‹¤.</p>
</article>
          `;
          lastHtmlContent = blogContent.innerHTML;
          lastKeyword = keyword;
          // lastTitle = `${keyword} TOP 5 ì¶”ì²œ - ì‹¤ì‚¬ìš© í›„ê¸°ì™€ ì¶”ì²œ í¬ì¸íŠ¸ ì´ì •ë¦¬`;
          const titles = [
  `${keyword} TOP 5! ì‹¤ì œ êµ¬ë§¤ìë“¤ì´ ê·¹ì°¬í•œ ì´ìœ ëŠ”?`,
  `í›„íšŒ ì—†ëŠ” ì„ íƒ! ${keyword} ë² ìŠ¤íŠ¸ 5 ì™„ë²½ ë¹„êµ & ë¦¬ì–¼ í›„ê¸°`,
  `ì´ê±¸ ì•ˆ ë³´ë©´ ì†í•´! ${keyword} ì¸ê¸°ìƒí’ˆ 5ì¢… ì†”ì§ ë¦¬ë·°`,
  `êµ¬ë§¤ ì „ í•„ë…! ${keyword} TOP 5, ì§„ì§œ í›„ê¸°ì™€ ì¥ë‹¨ì  ê³µê°œ`,
  `ë‚´ëˆë‚´ì‚° ${keyword} BEST 5, ì™œ ì´ ì œí’ˆë“¤ì´ 1ìœ„ì¼ê¹Œ?`,
  `ì‹¤ì œ ì‚¬ìš©ìê°€ ë½‘ì€ ${keyword} ì¶”ì²œ 5ì„  | ì¥ì Â·ë‹¨ì Â·í›„ê¸° ì´ì •ë¦¬`,
  `ì´ê²ƒë§Œ ë³´ë©´ ë! ${keyword} ì¸ê¸°ìƒí’ˆ 5ì¢… ë¹„êµ+ë¦¬ì–¼ í›„ê¸°`,
  `ê³ ë¯¼ ë! ${keyword} TOP 5, êµ¬ë§¤ ì „ ê¼­ ë´ì•¼ í•  ë¦¬ì–¼ ë¦¬ë·°`,
  `ì§€ê¸ˆ ê°€ì¥ ì˜ ë‚˜ê°€ëŠ” ${keyword} 5ì¢…, ì†”ì§ í›„ê¸°ì™€ ì¶”ì²œ í¬ì¸íŠ¸`
];
// ëœë¤ ì„ íƒ
          lastTitle = titles[Math.floor(Math.random() * titles.length)];
          const mainTitleDiv = document.getElementById('mainTitle');
          if (mainTitleDiv) mainTitleDiv.textContent = lastTitle;
        } catch (err) {
          errorDiv.textContent = err.message;
        } finally {
          if (searchBtn) searchBtn.disabled = false;
          if (copyBtn) copyBtn.disabled = false;
          if (postBtn) postBtn.disabled = false;
          if (loadingDiv) loadingDiv.style.display = 'none';
        }
      }
      // Enter í‚¤ë¡œ ê²€ìƒ‰
      document.getElementById('keyword').addEventListener('keypress', function(e) {
        if (e.key === 'Enter') searchProducts();
      });

      // HTML ë³µì‚¬í•˜ê¸°
      function copyHtmlContent() {
        const blogContent = document.getElementById('blogContent');
        if (!blogContent) return;
        navigator.clipboard.writeText(blogContent.innerHTML).then(() => {
          const msg = document.getElementById('successMsg');
          msg.textContent = 'HTMLì´ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!';
          msg.style.display = 'block';
          setTimeout(() => { msg.style.display = 'none'; }, 2000);
        });
      }

      // ì›Œë“œí”„ë ˆìŠ¤ ì„ì‹œê¸€ í¬ìŠ¤íŒ…
      async function postToWordPress() {
        if (!lastHtmlContent) return;
        const btn = document.getElementById('postWpBtn');
        const msg = document.getElementById('successMsg');
        const err = document.getElementById('wpError');
        btn.disabled = true;
        msg.style.display = 'none';
        err.style.display = 'none';
        try {
          const res = await fetch('/post-to-wordpress', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
              title: lastTitle,
              content: lastHtmlContent,
              keyword: lastKeyword
            })
          });
          const data = await res.json();
          if (data.success) {
            msg.textContent = 'ì›Œë“œí”„ë ˆìŠ¤ ì„ì‹œê¸€ë¡œ ì„±ê³µì ìœ¼ë¡œ í¬ìŠ¤íŒ…ë˜ì—ˆìŠµë‹ˆë‹¤!';
            msg.style.display = 'block';
          } else {
            err.textContent = data.message || 'ì›Œë“œí”„ë ˆìŠ¤ í¬ìŠ¤íŒ…ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.';
            err.style.display = 'block';
          }
        } catch (e) {
          err.textContent = 'ì›Œë“œí”„ë ˆìŠ¤ í¬ìŠ¤íŒ… ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.';
          err.style.display = 'block';
        } finally {
          btn.disabled = false;
        }
      }

      function copyTitle() {
        const mainTitleDiv = document.getElementById('mainTitle');
        if (!mainTitleDiv) return;
        navigator.clipboard.writeText(mainTitleDiv.textContent).then(() => {
          const msg = document.getElementById('successMsg');
          msg.textContent = 'ì œëª©ì´ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!';
          msg.style.display = 'block';
          setTimeout(() => { msg.style.display = 'none'; }, 2000);
        });
      }
    </script>
  </body>
</html>
